# 设备操作类型简化说明

## 🎯 简化理念

基于硬件通信的本质，我们通过设置目标值来统一控制设备，简化了复杂的操作类型，使代码更接近硬件实现。

## 📋 简化前后对比

### 泵设备操作简化

#### 🔴 简化前（复杂操作类型）
```javascript
// 吸取操作
{ action: 'aspirate', parameters: { volume: 500 } }

// 排出操作  
{ action: 'dispense', parameters: { volume: 300 } }

// 排空操作
{ action: 'empty', parameters: {} }
```

#### ✅ 简化后（统一位置控制）
```javascript
// 吸取 = 设置位置到目标值（大于当前位置）
{ action: 'setPosition', parameters: { position: 500 } }

// 排出 = 设置位置到目标值（小于当前位置）
{ action: 'setPosition', parameters: { position: 200 } }

// 排空 = 设置位置为0
{ action: 'setPosition', parameters: { position: 0 } }
```

### 阀门操作标准化

#### 术语修正
- **阀门位置** → **阀门孔位**（1-6号孔位，无单位）
- 使用 `setPort` 而不是 `setPosition`

#### 废液排出统一标准
- **6号孔位** = 固定的废液排出口
- 所有废液操作统一使用：`{ action: 'setPort', parameters: { port: 6 } }`

## 🔧 核心简化的操作类型

### 保留的基础操作
1. **setPosition** - 泵位置控制（微升单位）
2. **setPort** - 阀门孔位控制（1-6号孔位，无单位）
3. **setSpeed** - 速度设置
4. **setTemp** - 温度设置
5. **setFlowRate** - 流速设置
6. **setIntensity** - 光强设置

### 移除的复杂操作
1. ~~aspirate~~ → 使用 `setPosition`
2. ~~dispense~~ → 使用 `setPosition`  
3. ~~empty~~ → 使用 `setPosition({ position: 0 })`
4. ~~open/close~~ → 使用 `setPosition`

## 📊 工作流步骤的变化

### 1. 泵润洗步骤
```javascript
// 简化前
{ action: 'empty', parameters: {} }

// 简化后  
{ action: 'setPosition', parameters: { position: 0 } }
```

### 2. 抽吸反应溶液步骤
```javascript
// 简化前
{ action: 'aspirate', parameters: { volume: pump.parameters.position } }

// 简化后
{ action: 'setPosition', parameters: { position: pump.parameters.position } }
```

### 3. 反应运行步骤
```javascript
// 简化前
{ action: 'dispense', parameters: { volume: pump.parameters.position } }
// 或
{ action: 'empty', parameters: {} }

// 简化后（统一推出到0位置）
{ action: 'setPosition', parameters: { position: 0 } }
```

### 4. 废液排出步骤
```javascript
// 标准化 - 阀门使用setPort
{ action: 'setPort', parameters: { port: 6 } } // 固定6号孔位
```

### 5. 系统清洗步骤
```javascript
// 简化前
{ action: 'aspirate', parameters: { volume: cleaningVolume } }
{ action: 'dispense', parameters: { volume: cleaningVolume * 0.95 } }

// 简化后
{ action: 'setPosition', parameters: { position: cleaningVolume } }  // 吸取
{ action: 'setPosition', parameters: { position: 0 } }              // 排出
```

## 🎯 优势

### 1. **硬件一致性**
- 直接映射到硬件通信协议
- 减少上位机到下位机的转换复杂度

### 2. **代码简化**
- 统一的操作接口
- 减少条件判断和分支逻辑
- 更易维护和扩展

### 3. **逻辑清晰**
- 操作意图更明确
- 参数含义更直观
- 减少歧义和误解

### 4. **性能提升**
- 减少不必要的抽象层
- 更直接的硬件控制
- 降低通信延迟

## 🔄 向后兼容

现有的工作流会自动适配新的操作类型，不需要手动修改已保存的任务参数。

## 📝 注意事项

1. **位置语义**：
   - `position: 0` = 完全排空/初始位置
   - `position: > 0` = 相应的体积位置

2. **孔位约定**：
   - `port: 6` = 固定废液排出孔位
   - `port: 5` = 清洗液孔位（约定）

3. **条件生成**：
   - 统一使用 `setPosition` 生成位置监控条件
   - 根据设备类型调整容差和超时时间

## 🚀 实施状态

- ✅ 工作流生成逻辑已更新
- ✅ 条件检查机制已简化  
- ✅ TopControl执行逻辑已适配
- ✅ 硬件通信接口保持兼容

这种简化使我们的代码更贴近硬件实现，提高了系统的可靠性和可维护性。 